!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@pansy/is-string"),require("@pansy/is-array"),require("@pansy/group-by")):"function"==typeof define&&define.amd?define(["@pansy/is-string","@pansy/is-array","@pansy/group-by"],r):(t=t||self).policy=r(t.isString,t.isArray,t.groupBy)}(this,(function(isString,isArray,groupBy){"use strict";function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var r=0,i=new Array(t.length);r<t.length;r++)i[r]=t[r];return i}}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}isString=isString&&isString.hasOwnProperty("default")?isString.default:isString,isArray=isArray&&isArray.hasOwnProperty("default")?isArray.default:isArray,groupBy=groupBy&&groupBy.hasOwnProperty("default")?groupBy.default:groupBy;var Policy=function Policy(actions,separator){var _this=this;_classCallCheck(this,Policy),this.moduleMap={},this.getModuleMap=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r={};return t&&(r=groupBy(t,(function(t){return t.module}),(function(t){return"".concat(t.module).concat(_this.separator).concat(t.action)}))),r},this.combinationVerify=function(actionStr){var regStr="([\\w|\\d|\\*]+\\/[\\w|*]+)|\\*",reg=new RegExp(regStr,"g");return(actionStr.match(reg)||[]).map((function(t){var r=_this.singleVerify(t)?"true":"false";actionStr=actionStr.replace(new RegExp(regStr),r)})),!!eval(actionStr)},this.multipleVerify=function(t){if(isString(t))return _this.singleVerify(t);if(isArray(t))for(var r=0,i=t.length;r<i;r++){if(!_this.singleVerify(t[r]))return!1}return!0},this.singleVerify=function(t){return"*"===t||!_this.denyActions.includes(t)&&!!_this.allowActions.includes(t)},this.addPolicy=function(t){if(t){var r=t.statement;r&&r.length&&r.forEach((function(t){var r=t.effect,i=t.action,n=[];if(isString(i)&&(n=_this.parseAction(i)),isArray(i)&&i.forEach((function(t){n=n.concat(_this.parseAction(t))})),"allow"!==r)if("deny"!==r);else{var e=_this.denyActions.concat(n);_this.denyActions=_toConsumableArray(new Set(e))}else{var a=_this.allowActions.concat(n);_this.allowActions=_toConsumableArray(new Set(a))}}))}},this.parseAction=function(t){var r=_this.getAllAction(),i=[];if("*"===t)i=r;else{var n=t.split(_this.separator);if(2===n.length){var e=n[0];"*"===n[1]?r.length&&(i=_this.moduleMap[e]||[]):i=[t]}}return i},this.getAllAction=function(){var t=[];return Object.keys(_this.moduleMap).forEach((function(r){t=t.concat(_this.moduleMap[r])})),t},this.separator=separator||"/",this.moduleMap=this.getModuleMap(actions),this.allowActions=[],this.denyActions=[]};return Policy}));
//# sourceMappingURL=index.umd.min.js.map
